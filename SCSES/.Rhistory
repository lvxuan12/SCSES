devtools::document()
devtools::build()
library(SESES)
devtools::check()
devtools::document()
devtools::check()
library(roxygen2)
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::build()
?SCSES
installed.packages("/disk/lvxuan/Single-Splicing/src/package/SCSES_0.1.0.tar.gz")
installed.packages("/disk/lvxuan/Single-Splicing/src/package/SCSES_0.1.0.tar.gz",repos=NULL,type="source")
#------------------------
#     FigS3 t-cell
#------------------------
rm(list = ls())
# library(SeuratDisk)
library(Seurat)
library(plot1cell)
setwd("/disk/lvxuan/pitnet/")
seuratObject <- readRDS(file = "/share/huangyue/pitnets_seuratObject_Final.rds")
seuratObject <- SetIdent(seuratObject, value = "newleiden3")
###############T cell sub clustering ###############
seuratObject_t=subset(seuratObject,newleiden3=="Tcell")
###############T cell silhouette###############
library(cluster)
library(reticulate)
library(clusterSim)
library(lisi)
ad <- import("anndata")
data_h5 <- ad$read_h5ad("/disk/huangy/xtdisk/08_pituitary/06_scRNA/01_scanpy/20230926_6wf/Pituitary_scanpy_pc40_nb06_res08_out0927.h5ad")
X=data_h5$obsm['X_pca']
X=X[,1:40]
X[1:3,1:3]
colnames(data_h5$obsm['X_pca'])[1]
data_h5$obs[1:3,1:3]
rownames(X)=row.names(data_h5$obs)
dim(X)
X=X[colnames(seuratObject_t),]
dim(X)
cell_dist=dist(X)
dim(X)
cell_dist=as.matrix(cell_dist)
dim(cell_dist)
X[1:3,1:3]
cell_dist[1:3,1:3]
seuratObject_t$Pathological2=seuratObject_t$Pathological
seuratObject_t$Pathological2[which(seuratObject_t$Pathological2=="PG")]="PRL"
sil_sample=lapply(c("GH","Normal","PRL","SCA","TSH","GO"), function(x){
# sil_sample=lapply(c("PIT1","TPIT"), function(x){
df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Pathological2==x),]
# df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Subtype==x),]
##sample to the same cell number
# t=table(df$sampleID)
# t=t[which(t!=0)]
# num_min=t[which.min(t)]
# sample_select=lapply(names(t),function(x){
#   cell_id_t=row.names(df)[which(df$sampleID==x)]
#   sample(x = cell_id_t,size = num_min)
# })
# sample_select=unlist(sample_select)
# df=df[sample_select,]
# cell_select_idx_tmp=match(row.names(df),cell_name)
# cell_dist=data_h5$obsp['distances']
cell_dist_tmp=cell_dist[row.names(df),row.names(df)]
sampleID=as.numeric(df$sampleID)
sil_sample=silhouette(sampleID,cell_dist_tmp)
sil_sample=as.data.frame(sil_sample)
name_match=data.frame(name1=levels(df$sampleID),
name2=1:18)
sil_sample$cluster2=name_match$name1[match(sil_sample$cluster,name_match$name2)]
sil_sample$Pathological=x
sil_sample$cell_id=row.names(df)
# sil_sample$Subtype=x
return(sil_sample)
})
sil_sample=do.call(what = rbind,args = sil_sample)
ggplot(sil_sample,mapping = aes(x = cluster2,y=sil_width))+
geom_boxplot()
DimPlot(seuratObject_t,
cells = names(seuratObject_t$sampleID)[which(seuratObject_t$sampleID%in%c("P03","P07"))],
group.by = "sampleID")
table(seuratObject_t@meta.data$sampleID,seuratObject_t@meta.data$Pathological)
DimPlot(seuratObject_t,
cells = names(seuratObject_t$sampleID)[which(seuratObject_t$sampleID%in%c("P02","P07"))],
group.by = "sampleID")
sil_sample=lapply(c("GH","Normal","PRL","SCA","TSH","GO"), function(x){
# sil_sample=lapply(c("PIT1","TPIT"), function(x){
df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Pathological2==x),]
# df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Subtype==x),]
##sample to the same cell number
t=table(df$sampleID)
t=t[which(t!=0)]
num_min=t[which.min(t)]
sample_select=lapply(names(t),function(x){
cell_id_t=row.names(df)[which(df$sampleID==x)]
sample(x = cell_id_t,size = num_min)
})
sample_select=unlist(sample_select)
df=df[sample_select,]
# cell_select_idx_tmp=match(row.names(df),cell_name)
# cell_dist=data_h5$obsp['distances']
cell_dist_tmp=cell_dist[row.names(df),row.names(df)]
sampleID=as.numeric(df$sampleID)
sil_sample=silhouette(sampleID,cell_dist_tmp)
sil_sample=as.data.frame(sil_sample)
name_match=data.frame(name1=levels(df$sampleID),
name2=1:18)
sil_sample$cluster2=name_match$name1[match(sil_sample$cluster,name_match$name2)]
sil_sample$Pathological=x
sil_sample$cell_id=row.names(df)
# sil_sample$Subtype=x
return(sil_sample)
})
sil_sample=do.call(what = rbind,args = sil_sample)
ggplot(sil_sample,mapping = aes(x = cluster2,y=sil_width))+
geom_boxplot()
sil_sample=lapply(c("GH","Normal","PRL","SCA","TSH","GO"), function(x){
# sil_sample=lapply(c("PIT1","TPIT"), function(x){
df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Pathological==x),]
# df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Subtype==x),]
##sample to the same cell number
# t=table(df$sampleID)
# t=t[which(t!=0)]
# num_min=t[which.min(t)]
# sample_select=lapply(names(t),function(x){
#   cell_id_t=row.names(df)[which(df$sampleID==x)]
#   sample(x = cell_id_t,size = num_min)
# })
# sample_select=unlist(sample_select)
# df=df[sample_select,]
# cell_select_idx_tmp=match(row.names(df),cell_name)
# cell_dist=data_h5$obsp['distances']
cell_dist_tmp=cell_dist[row.names(df),row.names(df)]
sampleID=as.numeric(df$sampleID)
sil_sample=silhouette(sampleID,cell_dist_tmp)
sil_sample=as.data.frame(sil_sample)
name_match=data.frame(name1=levels(df$sampleID),
name2=1:18)
sil_sample$cluster2=name_match$name1[match(sil_sample$cluster,name_match$name2)]
sil_sample$Pathological=x
sil_sample$cell_id=row.names(df)
# sil_sample$Subtype=x
return(sil_sample)
})
sil_sample=do.call(what = rbind,args = sil_sample)
ggplot(sil_sample,mapping = aes(x = cluster2,y=sil_width))+
geom_boxplot()
DimPlot(seuratObject_t,
cells = names(seuratObject_t$sampleID)[which(seuratObject_t$sampleID%in%c("P02","P07"))],
group.by = "sampleID")
DimPlot(seuratObject_t,
cells = names(seuratObject_t$sampleID)[which(seuratObject_t$sampleID%in%c("P02"))],
group.by = "sampleID")
meta_new=read.table('metadata0909_newleiden.tsv')
meta_new[1:3,1:3]
table(meta_new$leiden,meta_new$sampleID)
table(meta_new$leiden,meta_new$Pathological)
table(meta_new$sampleID,meta_new$Pathological)
?subset
row.names(seuratObject_t)[1]
id=intersect(colnames(seuratObject_t),row.names(meta_new)[which(meta_new$leiden==18)])
seuratObject_t1=subset(seuratObject_t,cells=id)
sil_sample=lapply(c("GH","Normal","PRL","SCA","TSH","GO"), function(x){
# sil_sample=lapply(c("PIT1","TPIT"), function(x){
df=seuratObject_t1@meta.data[which(seuratObject_t1@meta.data$Pathological==x),]
# df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Subtype==x),]
##sample to the same cell number
# t=table(df$sampleID)
# t=t[which(t!=0)]
# num_min=t[which.min(t)]
# sample_select=lapply(names(t),function(x){
#   cell_id_t=row.names(df)[which(df$sampleID==x)]
#   sample(x = cell_id_t,size = num_min)
# })
# sample_select=unlist(sample_select)
# df=df[sample_select,]
# cell_select_idx_tmp=match(row.names(df),cell_name)
# cell_dist=data_h5$obsp['distances']
cell_dist_tmp=cell_dist[row.names(df),row.names(df)]
sampleID=as.numeric(df$sampleID)
sil_sample=silhouette(sampleID,cell_dist_tmp)
sil_sample=as.data.frame(sil_sample)
name_match=data.frame(name1=levels(df$sampleID),
name2=1:18)
sil_sample$cluster2=name_match$name1[match(sil_sample$cluster,name_match$name2)]
sil_sample$Pathological=x
sil_sample$cell_id=row.names(df)
# sil_sample$Subtype=x
return(sil_sample)
})
sil_sample=do.call(what = rbind,args = sil_sample)
ggplot(sil_sample,mapping = aes(x = cluster2,y=sil_width))+
geom_boxplot()
View(sil_sample)
id=intersect(colnames(seuratObject_t),row.names(meta_new)[which(meta_new$leiden==27)])
seuratObject_t2=subset(seuratObject_t,cells=id)
sil_sample=lapply(c("GH","Normal","PRL","SCA","TSH","GO"), function(x){
# sil_sample=lapply(c("PIT1","TPIT"), function(x){
df=seuratObject_t2@meta.data[which(seuratObject_t2@meta.data$Pathological==x),]
# df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Subtype==x),]
##sample to the same cell number
# t=table(df$sampleID)
# t=t[which(t!=0)]
# num_min=t[which.min(t)]
# sample_select=lapply(names(t),function(x){
#   cell_id_t=row.names(df)[which(df$sampleID==x)]
#   sample(x = cell_id_t,size = num_min)
# })
# sample_select=unlist(sample_select)
# df=df[sample_select,]
# cell_select_idx_tmp=match(row.names(df),cell_name)
# cell_dist=data_h5$obsp['distances']
cell_dist_tmp=cell_dist[row.names(df),row.names(df)]
sampleID=as.numeric(df$sampleID)
sil_sample=silhouette(sampleID,cell_dist_tmp)
sil_sample=as.data.frame(sil_sample)
name_match=data.frame(name1=levels(df$sampleID),
name2=1:18)
sil_sample$cluster2=name_match$name1[match(sil_sample$cluster,name_match$name2)]
sil_sample$Pathological=x
sil_sample$cell_id=row.names(df)
# sil_sample$Subtype=x
return(sil_sample)
})
sil_sample=do.call(what = rbind,args = sil_sample)
ggplot(sil_sample,mapping = aes(x = cluster2,y=sil_width))+
geom_boxplot()
DimPlot(seuratObject_t2,
group.by = "sampleID")
DimPlot(seuratObject_t2,
cells = names(seuratObject_t$sampleID)[which(seuratObject_t$sampleID%in%c("P07"))],
group.by = "sampleID")
DimPlot(seuratObject_t2,
cells = names(seuratObject_t2$sampleID)[which(seuratObject_t2$sampleID%in%c("P07"))],
group.by = "sampleID")
DimPlot(seuratObject_t2,
cells = names(seuratObject_t2$sampleID)[which(seuratObject_t2$sampleID%in%c("P07","P03"))],
group.by = "sampleID")
DimPlot(seuratObject_t2,
cells = names(seuratObject_t2$sampleID)[which(seuratObject_t2$sampleID%in%c("P07","P04"))],
group.by = "sampleID")
DimPlot(seuratObject_t2,
group.by = "sampleID")
DimPlot(seuratObject_t2,
cells = names(seuratObject_t2$sampleID)[which(seuratObject_t2$sampleID%in%c("P07","P02"))],
group.by = "sampleID")
table(seuratObject_t$sampleID,seuratObject_t$Pathological)
sampleID=as.numeric(seuratObject_t$sampleID)
sil_sample=silhouette(sampleID,cell_dist)
sil_sample=as.data.frame(sil_sample)
name_match=data.frame(name1=levels(seuratObject_t$sampleID),
name2=1:18)
sil_sample$cluster2=name_match$name1[match(sil_sample$cluster,name_match$name2)]
head(sil_sample)
ggplot(sil_sample,mapping = aes(x = cluster2,y=sil_width))+
geom_boxplot()
write.table(sil_sample,'/disk/lvxuan/pitnet/Tcell_sil_sample.txt',sep="\t",
quote=F,row.names = F)
levels(df$sampleID)
sil_sample=lapply(c("GH","Normal","PRL","SCA","TSH","GO"), function(x){
# sil_sample=lapply(c("PIT1","TPIT"), function(x){
df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Pathological==x),]
# df=seuratObject_t@meta.data[which(seuratObject_t@meta.data$Subtype==x),]
##sample to the same cell number
# t=table(df$sampleID)
# t=t[which(t!=0)]
# num_min=t[which.min(t)]
# sample_select=lapply(names(t),function(x){
#   cell_id_t=row.names(df)[which(df$sampleID==x)]
#   sample(x = cell_id_t,size = num_min)
# })
# sample_select=unlist(sample_select)
# df=df[sample_select,]
# cell_select_idx_tmp=match(row.names(df),cell_name)
# cell_dist=data_h5$obsp['distances']
cell_dist_tmp=cell_dist[row.names(df),row.names(df)]
sampleID=as.numeric(df$sampleID)
sil_sample=silhouette(sampleID,cell_dist_tmp)
sil_sample=as.data.frame(sil_sample)
name_match=data.frame(name1=levels(df$sampleID),
name2=1:18)
sil_sample$cluster2=name_match$name1[match(sil_sample$cluster,name_match$name2)]
sil_sample$Pathological=x
sil_sample$cell_id=row.names(df)
# sil_sample$Subtype=x
return(sil_sample)
})
sil_sample=do.call(what = rbind,args = sil_sample)
write.table(sil_sample,'/disk/lvxuan/pitnet/Tcell_sil_sample_per_Pathological.txt',sep="\t",
quote=F,row.names = F)
